<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒé§•ç…§äº’æƒ æŸ¥è©¢ v4.1</title>
    <style>
        :root {
            --status-green: #3cb371; --status-orange: #ffa500; --status-red: #f08080;
            --intl-bg: #d1e3e9; --tw-bg: #e9e2d1; --sidebar-w: 280px;
        }

        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; margin: 0; background: #f4f6f8; color: #333; display: flex; flex-direction: column; }
        
        /* æ¨™é¡Œå„ªåŒ– */
        header { background: #2c3e50; color: white; padding: 2rem; text-align: center; }
        header h1 { margin: 0; font-size: 2.2rem; }
        header h3 { margin: 12px 0 0; font-weight: 300; letter-spacing: 1px; }

        .main-layout { display: flex; flex: 1; }
        aside { width: var(--sidebar-w); background: #fff; padding: 25px; border-right: 1px solid #ddd; height: calc(100vh - 160px); position: sticky; top: 0; overflow-y: auto; }
        
        .content { flex: 1; padding: 20px; }
        /* Pinterest éŒ¯è½ä½ˆå±€ */
        .masonry { column-count: 3; column-gap: 20px; }

        /* åœ‹å®¶ç¾¤çµ„å¡ç‰‡ */
        .country-group { break-inside: avoid; margin-bottom: 25px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); background: white; border: 1px solid #eee; }
        .group-header { background: #fff; padding: 15px; text-align: center; font-size: 1.3rem; font-weight: bold; border-bottom: 1px solid #f0f0f0; color: #2c3e50; }
        
        .sub-card { padding: 15px; }
        .type-intl { background: var(--intl-bg); border-bottom: 1px dashed #bbb; }
        .type-gen { background: var(--tw-bg); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 20px; color: white; font-size: 0.8rem; font-weight: bold; margin: 8px 0; }
        .bg-success { background: var(--status-green); }
        .bg-warning { background: var(--status-orange); }
        .bg-danger { background: var(--status-red); }

        .info-row { font-size: 0.9rem; margin-bottom: 5px; line-height: 1.4; }

        /* RWD èª¿æ•´ */
        @media (max-width: 1200px) { .masonry { column-count: 2; } }
        @media (max-width: 768px) { 
            .main-layout { flex-direction: column; } 
            aside { width: 100%; height: auto; position: relative; border-right: none; border-bottom: 1px solid #ddd; } 
            .masonry { column-count: 1; } 
        }
    </style>
</head>
<body>

<header>
    <h1>å…¨çƒè­·ç…§äº’æƒ æŸ¥è©¢</h1>
    <h3>æŒæœ‰å°ç£ç›£ç†ç«™æ ¸ç™¼çš„ä¸€èˆ¬é§•ç…§ã€åœ‹éš›é§•ç…§</h3>
</header>

<div class="main-layout">
    <aside>
        <div class="filter-group">
            <h4>1. é¸æ“‡å€åŸŸ (æ´²åˆ¥)</h4>
            <div id="region-filters"></div>
        </div>
        <div style="margin-top:25px;">
            <h4>2. é§•ç…§é¡å‹</h4>
            <label><input type="checkbox" value="intl" class="type-chk" checked> åœ‹éš›é§•ç…§</label><br>
            <label><input type="checkbox" value="gen" class="type-chk" checked> å°ç£ä¸€èˆ¬é§•ç…§</label>
        </div>
        <div style="margin-top:25px;">
            <h4>3. äº’æƒ ç‹€æ…‹</h4>
            <label><input type="checkbox" value="success" class="status-chk"> Allowed å¯ä»¥ä½¿ç”¨</label><br>
            <label><input type="checkbox" value="warning" class="status-chk"> Conditional ä¾æ¢ä»¶ä½¿ç”¨</label><br>
            <label><input type="checkbox" value="danger" class="status-chk"> Prohibited ä¸å¯ä½¿ç”¨</label>
        </div>
    </aside>

    <main class="content">
        <div class="masonry" id="card-grid"></div>
    </main>
</div>

<script>
    const labels = { success: "Allowed å¯ä»¥ä½¿ç”¨", warning: "Conditional ä¾æ¢ä»¶ä½¿ç”¨", danger: "Prohibited ä¸å¯ä½¿ç”¨" };
    let uniqueData = [];

    async function init() {
        // åŠ ä¸Šéš¨æ©Ÿåƒæ•¸é¿å…å¿«å–
        const res = await fetch(`data/data.json?t=${Date.now()}`);
        const raw = await res.json();
        
        // --- æ ¸å¿ƒä¿®æ­£ï¼šè³‡æ–™å»é‡é‚è¼¯ ---
        // ä½¿ç”¨ Map ä»¥åœ‹å®¶åç¨±ç‚º Keyï¼Œç¢ºä¿æ¯å€‹åœ‹å®¶åªç•™ä¸‹ä¸€ç­†æœ€æ–°è¨˜éŒ„
        const dataMap = new Map();
        raw.forEach(item => {
            if (item.country) {
                dataMap.set(item.country.trim(), item);
            }
        });
        uniqueData = Array.from(dataMap.values());
        // ---------------------------

        setupRegionFilters();
        render();
    }

    function setupRegionFilters() {
        const regions = [...new Set(uniqueData.map(d => d.region))];
        const container = document.getElementById('region-filters');
        regions.forEach(r => {
            const el = document.createElement('div');
            el.innerHTML = `<label style="display:block; margin:5px 0;"><input type="checkbox" value="${r}" class="region-chk"> ${r}</label>`;
            el.onchange = render;
            container.appendChild(el);
        });
        document.querySelectorAll('.type-chk, .status-chk').forEach(c => c.onchange = render);
    }

    function render() {
        const activeRegions = Array.from(document.querySelectorAll('.region-chk:checked')).map(c => c.value);
        const activeTypes = Array.from(document.querySelectorAll('.type-chk:checked')).map(c => c.value);
        const activeStatus = Array.from(document.querySelectorAll('.status-chk:checked')).map(c => c.value);

        const grid = document.getElementById('card-grid');
        grid.innerHTML = '';

        const filtered = uniqueData.filter(d => {
            const regMatch = activeRegions.length === 0 || activeRegions.includes(d.region);
            const statusMatch = activeStatus.length === 0 || 
                                activeStatus.includes(d.international.status) || 
                                activeStatus.includes(d.general.status);
            return regMatch && statusMatch;
        });

        filtered.forEach(item => {
            const showIntl = activeTypes.includes('intl');
            const showGen = activeTypes.includes('gen');

            if (!showIntl && !showGen) return;

            const group = document.createElement('div');
            group.className = 'country-group';
            
            let html = `<div class="group-header">ğŸ“ ${item.country}</div>`;

            if (showIntl) {
                html += renderSubCard(item.international, 'International åœ‹éš›é§•ç…§', 'intl');
            }
            if (showGen) {
                html += renderSubCard(item.general, 'General å°ç£ä¸€èˆ¬é§•ç…§', 'gen');
            }

            group.innerHTML = html;
            grid.appendChild(group);
        });
    }

    function renderSubCard(info, title, type) {
        const val = (v) => (v && v !== "" && v !== "ç„¡") ? v : "ç„¡"; // ç©ºç™½è™•ç†
        return `
            <div class="sub-card type-${type}">
                <div style="font-size:0.75rem; font-weight:bold; opacity:0.6; text-transform:uppercase;">${title}</div>
                <div class="badge bg-${info.status}">${labels[info.status]}</div>
                <div class="info-row"><strong>ç•¶åœ°ä½¿ç”¨ï¼š</strong>${val(info.usage)}</div>
                <div class="info-row"><strong>å‚™è¨»ï¼š</strong>${val(info.notes)}</div>
            </div>
        `;
    }

    init();
</script>
</body>
</html>
