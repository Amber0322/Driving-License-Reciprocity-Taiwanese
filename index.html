<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全球駕照互惠查詢 - 優化版</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --intl-bg: #d1e3e9; /* 國際駕照區塊藍綠色 */
            --tw-bg: #e9e2d1;   /* 台灣一般駕照區塊淺褐色 */
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --text-main: #333;
        }

        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg-color); color: var(--text-main); margin: 0; }
        header { background: #2c3e50; color: white; padding: 25px; text-align: center; }
        .filter-bar { background: white; padding: 15px; border-bottom: 1px solid #ddd; text-align: center; font-weight: bold; }
        
        #back-btn { margin: 20px; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background: #ddd; font-weight: bold; transition: 0.2s; }
        #back-btn:hover { background: #ccc; }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; padding: 20px; max-width: 1200px; margin: 0 auto; }

        /* 第一層：大洲卡片 */
        .continent-card { background: #2c3e50; color: white; height: 150px; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-size: 1.5rem; }
        .continent-card:hover { transform: scale(1.03); background: #34495e; }

        /* 第二層：國家資訊卡片 (依照示意圖優化) */
        .country-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #eee; }
        .country-card h2 { margin: 0; padding: 15px; background: white; text-align: center; font-size: 1.4rem; border-bottom: 1px solid #f0f0f0; }

        /* 雙色塊設計 */
        .section { padding: 18px; position: relative; }
        .section-intl { background-color: var(--intl-bg); }
        .section-tw { background-color: var(--tw-bg); border-top: 1px solid rgba(0,0,0,0.05); }

        /* 狀態標籤 */
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; color: white; font-size: 0.85rem; font-weight: bold; margin-bottom: 10px; }
        .bg-success { background-color: var(--success-color); }
        .bg-warning { background-color: var(--warning-color); }
        .bg-danger { background-color: var(--danger-color); }

        .info-row { margin: 6px 0; font-size: 0.95rem; line-height: 1.5; }
        .info-row strong { color: #555; }
    </style>
</head>
<body>

<header>
    <h1>全球駕照互惠查詢</h1>
    <p>針對台灣駕照持有者之自駕與換照指引</p>
</header>

<div class="filter-bar">
    <span id="view-title">請選擇世界大洲</span>
</div>

<main id="app">
    <section id="continents-view">
        <div class="grid-container" id="continent-grid"></div>
    </section>

    <section id="countries-view" style="display:none;">
        <button id="back-btn" onclick="showContinents()">← 回到區域選擇</button>
        <div class="grid-container" id="country-grid"></div>
    </section>
</main>

<script>
    // 1. 設定與狀態對應
    const labels = {
        success: "Allowed 可以使用",
        warning: "Conditional 依條件使用",
        danger: "Prohibited 不可使用"
    };

    const continents = ["亞洲", "中南美洲", "非洲", "歐洲", "澳洲及大洋洲", "北美洲"];
    let fullData = [];

    // 2. 取得資料 (加上時間戳避免快取舊資料)
    async function loadData() {
        try {
            const res = await fetch(`data/data.json?t=${Date.now()}`);
            fullData = await res.json();
            renderContinents();
        } catch (e) {
            console.error("載入失敗:", e);
        }
    }

    // 3. 渲染第一層：大洲
    function renderContinents() {
        const grid = document.getElementById('continent-grid');
        grid.innerHTML = '';
        continents.forEach(name => {
            const card = document.createElement('div');
            card.className = 'continent-card';
            card.innerText = name;
            card.onclick = () => showCountries(name);
            grid.appendChild(card);
        });
    }

    // 4. 渲染第二層：國家 (修正文字缺失與標籤名稱)
    function showCountries(region) {
        window.scrollTo(0,0);
        document.getElementById('continents-view').style.display = 'none';
        document.getElementById('countries-view').style.display = 'block';
        document.getElementById('view-title').innerText = `區域：${region}`;

        const grid = document.getElementById('country-grid');
        grid.innerHTML = '';

        // 過濾資料，確保「歐洲」等地區名稱完全匹配
        const filtered = fullData.filter(d => d.region.trim() === region.trim());

        filtered.forEach(item => {
            // 處理空白為「無」的輔助函式
            const val = (v) => (v && v !== "" && v !== "無") ? v : "無";

            const card = document.createElement('div');
            card.className = 'country-card';
            card.innerHTML = `
                <h2>${item.country}</h2>
                
                <div class="section section-intl">
                    <div class="status-badge bg-${item.international.status}">
                        ${labels[item.international.status]}
                    </div>
                    <div class="info-row"><strong>當地使用：</strong>${val(item.international.usage)}</div>
                    <div class="info-row"><strong>免考換照：</strong>${val(item.international.exemption)}</div>
                    <div class="info-row"><strong>備註說明：</strong>${val(item.international.notes)}</div>
                </div>

                <div class="section section-tw">
                    <div class="status-badge bg-${item.general.status}">
                        ${labels[item.general.status]}
                    </div>
                    <div class="info-row"><strong>當地使用：</strong>${val(item.general.usage)}</div>
                    <div class="info-row"><strong>免考換照：</strong>${val(item.general.exemption)}</div>
                    <div class="info-row"><strong>備註說明：</strong>${val(item.general.notes)}</div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function showContinents() {
        document.getElementById('continents-view').style.display = 'block';
        document.getElementById('countries-view').style.display = 'none';
        document.getElementById('view-title').innerText = "請選擇世界大洲";
    }

    loadData();
</script>
</body>
</html>
