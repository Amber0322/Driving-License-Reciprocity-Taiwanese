<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒé§•ç…§äº’æƒ ç³»çµ± v3.0</title>
    <style>
        :root {
            /* ç¬¬ä¸€ç‰ˆç‡ˆè™Ÿé¡è‰² */
            --status-green: #3cb371;
            --status-orange: #ffa500;
            --status-red: #f08080;
            --intl-bg: #d1e3e9;
            --tw-bg: #e9e2d1;
            --sidebar-w: 280px;
        }

        body { font-family: "PingFang TC", sans-serif; margin: 0; background: #f4f6f8; color: #333; display: flex; flex-direction: column; }
        
        /* å°èˆªèˆ‡æ”¶è—é è¦½ */
        header { background: #2c3e50; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .fav-cart { position: relative; cursor: pointer; background: #34495e; padding: 8px 15px; border-radius: 20px; }
        .fav-count { background: var(--status-red); color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.7rem; margin-left: 5px; }
        .fav-popup { display: none; position: absolute; top: 45px; right: 0; width: 250px; background: white; color: #333; box-shadow: 0 5px 20px rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; z-index: 1001; }

        /* æ‰‹æ©Ÿç‰ˆç¯©é¸åˆ‡æ› */
        .mobile-filter-toggle { display: none; background: #34495e; color: white; padding: 10px; text-align: center; cursor: pointer; }

        .main-layout { display: flex; flex: 1; }
        
        /* å´é‚Šæ¬„èˆ‡èªªæ˜ */
        aside { width: var(--sidebar-w); background: #fff; padding: 20px; border-right: 1px solid #ddd; height: calc(100vh - 70px); position: sticky; top: 70px; overflow-y: auto; }
        .guide-box { background: #e8f4fd; padding: 12px; border-radius: 6px; font-size: 0.85rem; margin-bottom: 20px; border-left: 4px solid #3498db; }
        
        /* Pinterest éŒ¯è½ä½ˆå±€ */
        .content { flex: 1; padding: 20px; }
        .masonry { column-count: 3; column-gap: 20px; }

        /* æ‹†åˆ†å¾Œçš„ç¨ç«‹å¡ç‰‡ */
        .card { break-inside: avoid; margin-bottom: 20px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.08); background: white; border: 1px solid #eee; position: relative; }
        .card.type-intl { background: var(--intl-bg); }
        .card.type-gen { background: var(--tw-bg); }
        .card-body { padding: 15px; }
        .card-label { font-size: 0.7rem; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; opacity: 0.7; }
        
        /* ç‡ˆè™Ÿæ¨£å¼ */
        .badge { display: inline-block; padding: 3px 10px; border-radius: 15px; color: white; font-size: 0.8rem; font-weight: bold; margin: 10px 0; }
        .bg-success { background: var(--status-green); }
        .bg-warning { background: var(--status-orange); }
        .bg-danger { background: var(--status-red); }

        .fav-btn { position: absolute; top: 10px; right: 10px; border: none; background: rgba(255,255,255,0.8); border-radius: 50%; width: 30px; height: 30px; cursor: pointer; }

        /* RWD èª¿æ•´ */
        @media (max-width: 1024px) { .masonry { column-count: 2; } }
        @media (max-width: 768px) {
            .main-layout { flex-direction: column; }
            aside { width: 100%; height: auto; position: relative; top: 0; display: none; }
            aside.active { display: block; }
            .mobile-filter-toggle { display: block; }
            .masonry { column-count: 1; }
        }

        footer { text-align: center; padding: 20px; font-size: 0.8rem; color: #777; background: #fff; border-top: 1px solid #eee; }
    </style>
</head>
<body>

<header>
    <div><strong>å…¨çƒé§•ç…§äº’æƒ æŸ¥è©¢ v3.0</strong></div>
    <div class="fav-cart" onclick="toggleFavPopup()">
        â­ æ”¶è—æ¸…å–® <span class="fav-count" id="fav-count">0</span>
        <div class="fav-popup" id="fav-popup" onclick="event.stopPropagation()">
            <h4 style="margin-top:0">å·²æ”¶è—é …ç›®</h4>
            <div id="fav-list" style="font-size:0.85rem">å°šæœªæ”¶è—ä»»ä½•åœ‹å®¶</div>
        </div>
    </div>
</header>

<div class="mobile-filter-toggle" onclick="toggleSidebar()">ğŸ” é»é¸ä»¥ç¯©é¸æ¢ä»¶</div>

<div class="main-layout">
    <aside id="sidebar">
        <div class="guide-box">
            <strong>ç¯©é¸å¼•å°ï¼š</strong><br>
            1. å…ˆé¸æ“‡å€åŸŸ (æ´²åˆ¥)<br>
            2. é¸æ“‡é§•ç…§é¡å‹<br>
            3. é¸æ“‡äº’æƒ ç‹€æ…‹
        </div>

        <div class="filter-group">
            <h4>1. é¸æ“‡å€åŸŸ</h4>
            <div id="region-filters"></div>
        </div>

        <div class="filter-group">
            <h4>2. é§•ç…§é¡å‹</h4>
            <label><input type="checkbox" value="intl" class="type-chk"> åœ‹éš›é§•ç…§</label><br>
            <label><input type="checkbox" value="gen" class="type-chk"> å°ç£ä¸€èˆ¬é§•ç…§</label>
        </div>

        <div class="filter-group">
            <h4>3. äº’æƒ ç‹€æ…‹</h4>
            <label><input type="checkbox" value="success" class="status-chk"> Allowed å¯ä»¥ä½¿ç”¨</label><br>
            <label><input type="checkbox" value="warning" class="status-chk"> Conditional ä¾æ¢ä»¶ä½¿ç”¨</label><br>
            <label><input type="checkbox" value="danger" class="status-chk"> Prohibited ä¸å¯ä½¿ç”¨</label>
        </div>
    </aside>

    <main class="content">
        <div class="masonry" id="card-grid"></div>
    </main>
</div>

<footer>
    è³‡æ–™ä¾†æºï¼šä¸­è¯æ°‘åœ‹äº¤é€šéƒ¨å…¬è·¯ç¸½å±€ | æœ€å¾Œæ›´æ–°ï¼š2026-01-23 <br>
    æœ€æ–°è³‡è¨Šè«‹ç¢ºèªå…¬è·¯ç¸½å±€ç¶²ç«™
</footer>

<script>
    const labels = { success: "Allowed å¯ä»¥ä½¿ç”¨", warning: "Conditional ä¾æ¢ä»¶ä½¿ç”¨", danger: "Prohibited ä¸å¯ä½¿ç”¨" };
    let rawData = [];
    let flattenedData = [];
    let favorites = new Set();

    async function init() {
        const res = await fetch(`data/data.json?t=${Date.now()}`);
        rawData = await res.json();
        
        // æ ¸å¿ƒé‚è¼¯ï¼šå°‡è³‡æ–™æ‹†åˆ†æˆå…©å€æ•¸é‡çš„ç¨ç«‹ç‰©ä»¶
        rawData.forEach(d => {
            flattenedData.push({ ...d, cardType: 'intl', info: d.international, cardId: `${d.country}-intl` });
            flattenedData.push({ ...d, cardType: 'gen', info: d.general, cardId: `${d.country}-gen` });
        });

        setupRegionFilters();
        render();
    }

    function setupRegionFilters() {
        const regions = [...new Set(rawData.map(d => d.region))];
        const container = document.getElementById('region-filters');
        regions.forEach(r => {
            const el = document.createElement('div');
            el.innerHTML = `<label><input type="checkbox" value="${r}" class="region-chk"> ${r}</label>`;
            el.onchange = render;
            container.appendChild(el);
        });
        document.querySelectorAll('.type-chk, .status-chk').forEach(c => c.onchange = render);
    }

    function render() {
        const activeRegions = Array.from(document.querySelectorAll('.region-chk:checked')).map(c => c.value);
        const activeTypes = Array.from(document.querySelectorAll('.type-chk:checked')).map(c => c.value);
        const activeStatus = Array.from(document.querySelectorAll('.status-chk:checked')).map(c => c.value);

        const grid = document.getElementById('card-grid');
        grid.innerHTML = '';

        const filtered = flattenedData.filter(d => {
            const regMatch = activeRegions.length === 0 || activeRegions.includes(d.region);
            const typeMatch = activeTypes.length === 0 || activeTypes.includes(d.cardType);
            const statMatch = activeStatus.length === 0 || activeStatus.includes(d.info.status);
            return regMatch && typeMatch && statMatch;
        });

        filtered.forEach(d => {
            const card = document.createElement('div');
            card.className = `card type-${d.cardType}`;
            card.innerHTML = `
                <button class="fav-btn" onclick="toggleFav('${d.cardId}', '${d.country}', '${d.cardType}')">
                    ${favorites.has(d.cardId) ? 'â¤ï¸' : 'ğŸ¤'}
                </button>
                <div class="card-body">
                    <div class="card-label">${d.cardType === 'intl' ? 'International åœ‹éš›é§•ç…§' : 'General å°ç£ä¸€èˆ¬é§•ç…§'}</div>
                    <h3 style="margin:5px 0;">${d.country}</h3>
                    <div class="badge bg-${d.info.status}">${labels[d.info.status]}</div>
                    <div style="font-size:0.9rem;"><strong>ç•¶åœ°ä½¿ç”¨ï¼š</strong>${d.info.usage || 'ç„¡'}</div>
                    <div style="font-size:0.9rem; margin-top:5px;"><strong>å‚™è¨»ï¼š</strong>${d.info.notes || 'ç„¡'}</div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    // æ”¶è—æ©Ÿåˆ¶ï¼šåƒè³¼ç‰©è»Šé è¦½ä¸€æ¨£
    function toggleFav(id, country, type) {
        if (favorites.has(id)) favorites.delete(id);
        else favorites.add(id);
        updateFavUI();
        render();
    }

    function updateFavUI() {
        const countEl = document.getElementById('fav-count');
        const listEl = document.getElementById('fav-list');
        countEl.innerText = favorites.size;
        
        if (favorites.size === 0) {
            listEl.innerHTML = 'å°šæœªæ”¶è—ä»»ä½•åœ‹å®¶';
        } else {
            listEl.innerHTML = Array.from(favorites).map(id => {
                const [name, type] = id.split('-');
                return `<div style="margin-bottom:5px; border-bottom:1px solid #eee;">ğŸ“ ${name} (${type === 'intl' ? 'åœ‹éš›' : 'ä¸€èˆ¬'})</div>`;
            }).join('');
        }
    }

    function toggleFavPopup() {
        const p = document.getElementById('fav-popup');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('active');
    }

    init();
</script>
</body>
</html>
