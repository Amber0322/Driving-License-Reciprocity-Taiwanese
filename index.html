<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒé§•ç…§äº’æƒ æŸ¥è©¢ v4.0</title>
    <style>
        :root {
            --status-green: #3cb371; --status-orange: #ffa500; --status-red: #f08080;
            --intl-bg: #d1e3e9; --tw-bg: #e9e2d1; --sidebar-w: 280px;
        }

        body { font-family: "PingFang TC", sans-serif; margin: 0; background: #f4f6f8; color: #333; display: flex; flex-direction: column; }
        
        /* æ¨™é¡Œå„ªåŒ– */
        header { background: #2c3e50; color: white; padding: 2rem; text-align: center; }
        header h1 { margin: 0; font-size: 2.5rem; }
        header h3 { margin: 10px 0 0; font-weight: 300; opacity: 0.9; }

        .fav-cart { position: absolute; top: 20px; right: 20px; cursor: pointer; background: #34495e; padding: 8px 15px; border-radius: 20px; color: white; z-index: 1001; }

        .main-layout { display: flex; flex: 1; }
        aside { width: var(--sidebar-w); background: #fff; padding: 20px; border-right: 1px solid #ddd; height: calc(100vh - 150px); position: sticky; top: 0; overflow-y: auto; }
        
        .content { flex: 1; padding: 20px; }
        .masonry { column-count: 3; column-gap: 20px; }

        /* å¡ç‰‡è¨­è¨ˆ */
        .country-group { break-inside: avoid; margin-bottom: 25px; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); background: white; border: 1px solid #eee; }
        .group-header { background: white; padding: 15px; text-align: center; font-size: 1.4rem; border-bottom: 1px solid #f0f0f0; }
        
        .sub-card { padding: 15px; border-bottom: 1px dashed #ddd; }
        .sub-card:last-child { border-bottom: none; }
        .type-intl { background: var(--intl-bg); }
        .type-gen { background: var(--tw-bg); }

        .badge { display: inline-block; padding: 3px 12px; border-radius: 20px; color: white; font-size: 0.8rem; font-weight: bold; margin: 10px 0; }
        .bg-success { background: var(--status-green); }
        .bg-warning { background: var(--status-orange); }
        .bg-danger { background: var(--status-red); }

        /* RWD */
        @media (max-width: 1100px) { .masonry { column-count: 2; } }
        @media (max-width: 768px) { 
            .main-layout { flex-direction: column; } 
            aside { width: 100%; height: auto; position: relative; } 
            .masonry { column-count: 1; } 
        }
    </style>
</head>
<body>

<header>
    <h1>å…¨çƒé§•ç…§äº’æƒ æŸ¥è©¢</h1>
    <h3>æŒæœ‰å°ç£ç›£ç†ç«™æ ¸ç™¼çš„ä¸€èˆ¬é§•ç…§ã€åœ‹éš›é§•ç…§</h3>
</header>

<div class="fav-cart" onclick="toggleFavPopup()">â­ æ”¶è—æ¸…å–® <span id="fav-count">0</span></div>

<div class="main-layout">
    <aside>
        <div class="filter-group">
            <h4>1. é¸æ“‡å€åŸŸ</h4>
            <div id="region-filters"></div>
        </div>
        <div class="filter-group">
            <h4>2. é§•ç…§é¡å‹</h4>
            <label><input type="checkbox" value="intl" class="type-chk" checked> åœ‹éš›é§•ç…§</label><br>
            <label><input type="checkbox" value="gen" class="type-chk" checked> å°ç£ä¸€èˆ¬é§•ç…§</label>
        </div>
        <div class="filter-group">
            <h4>3. äº’æƒ ç‹€æ…‹</h4>
            <label><input type="checkbox" value="success" class="status-chk"> Allowed å¯ä»¥ä½¿ç”¨</label><br>
            <label><input type="checkbox" value="warning" class="status-chk"> Conditional ä¾æ¢ä»¶ä½¿ç”¨</label><br>
            <label><input type="checkbox" value="danger" class="status-chk"> Prohibited ä¸å¯ä½¿ç”¨</label>
        </div>
    </aside>

    <main class="content">
        <div class="masonry" id="card-grid"></div>
    </main>
</div>

<script>
    const labels = { success: "Allowed å¯ä»¥ä½¿ç”¨", warning: "Conditional ä¾æ¢ä»¶ä½¿ç”¨", danger: "Prohibited ä¸å¯ä½¿ç”¨" };
    let rawData = [];

    async function init() {
        const res = await fetch(`data/data.json?t=${Date.now()}`);
        rawData = await res.json();
        setupRegionFilters();
        render();
    }

    function setupRegionFilters() {
        const regions = [...new Set(rawData.map(d => d.region))];
        const container = document.getElementById('region-filters');
        regions.forEach(r => {
            const el = document.createElement('div');
            el.innerHTML = `<label><input type="checkbox" value="${r}" class="region-chk"> ${r}</label>`;
            el.onchange = render;
            container.appendChild(el);
        });
        document.querySelectorAll('.type-chk, .status-chk').forEach(c => c.onchange = render);
    }

    function render() {
        const activeRegions = Array.from(document.querySelectorAll('.region-chk:checked')).map(c => c.value);
        const activeTypes = Array.from(document.querySelectorAll('.type-chk:checked')).map(c => c.value);
        const activeStatus = Array.from(document.querySelectorAll('.status-chk:checked')).map(c => c.value);

        const grid = document.getElementById('card-grid');
        grid.innerHTML = '';

        // æ ¸å¿ƒé‚è¼¯ï¼šå…ˆæ ¹æ“šå€åŸŸèˆ‡ç‹€æ…‹éæ¿¾åŸå§‹è³‡æ–™
        const filtered = rawData.filter(d => {
            const regMatch = activeRegions.length === 0 || activeRegions.includes(d.region);
            // åªè¦å…¶ä¸­ä¸€ç¨®é§•ç…§ç¬¦åˆå‹¾é¸çš„ç‹€æ…‹å³å¯
            const statMatch = activeStatus.length === 0 || activeStatus.includes(d.international.status) || activeStatus.includes(d.general.status);
            return regMatch && statMatch;
        });

        filtered.forEach(item => {
            // åˆ¤æ–·è©²åœ‹å®¶æ˜¯å¦è¦é¡¯ç¤ºå°æ‡‰å…§å®¹
            const showIntl = activeTypes.includes('intl');
            const showGen = activeTypes.includes('gen');

            if (!showIntl && !showGen) return;

            // å»ºç«‹å®¹å™¨å¡ç‰‡
            const group = document.createElement('div');
            group.className = 'country-group';
            
            let html = `<div class="group-header">ğŸ“ ${item.country}</div>`;

            if (showIntl) {
                html += renderSubCard(item.international, 'International åœ‹éš›é§•ç…§', 'intl');
            }
            if (showGen) {
                html += renderSubCard(item.general, 'General å°ç£ä¸€èˆ¬é§•ç…§', 'gen');
            }

            group.innerHTML = html;
            grid.appendChild(group);
        });
    }

    function renderSubCard(info, title, type) {
        return `
            <div class="sub-card type-${type}">
                <div style="font-size:0.7rem; font-weight:bold; opacity:0.6;">${title}</div>
                <div class="badge bg-${info.status}">${labels[info.status]}</div>
                <div style="font-size:0.9rem;"><strong>ç•¶åœ°ä½¿ç”¨ï¼š</strong>${info.usage || 'ç„¡'}</div>
                <div style="font-size:0.9rem; margin-top:5px;"><strong>å‚™è¨»ï¼š</strong>${info.notes || 'ç„¡'}</div>
            </div>
        `;
    }

    init();
</script>
</body>
</html>
